<%# Hide the navbar DM badges when on conversations page %>
<%= turbo_frame_tag "dm_badge_mobile" %>
<%= turbo_frame_tag "dm_badge_desktop" %>

<div class="messages-page" data-controller="tabs swipe-nav" data-swipe-nav-right-url-value="<%= notifications_path %>">
  <div class="messages-header">
    <h1><i class="fa-regular fa-paper-plane"></i> Messages</h1>
    <%= link_to new_conversation_path, class: "new-chat-btn" do %>
      <i class="fa-solid fa-pen-to-square"></i>
    <% end %>
  </div>

  <!-- Tabs -->
  <div class="messages-tabs">
    <button class="tab-btn" data-tabs-target="tab" data-action="click->tabs#switch">
      Messages
      <%= turbo_frame_tag "messages_tab_badge" do %>
        <% unread_messages = @conversations.sum { |c| c.unread_count_for(current_user) } %>
        <% if unread_messages > 0 %>
          <span class="tab-badge"><%= unread_messages %></span>
        <% end %>
      <% end %>
    </button>
    <button class="tab-btn" data-tabs-target="tab" data-action="click->tabs#switch">
      Requests
      <%= turbo_frame_tag "requests_tab_badge" do %>
        <% if @requests.any? %>
          <span class="tab-badge"><%= @requests.count %></span>
        <% end %>
      <% end %>
    </button>
  </div>

  <!-- Conversations Tab -->
  <div class="tab-content" data-tabs-target="content">
    <% if @conversations.any? %>
      <div class="conversations-list">
        <% @conversations.each do |conversation| %>
          <%= render "conversations/conversation", conversation: conversation %>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <i class="fa-regular fa-comments"></i>
        <p>No messages yet</p>
        <span class="empty-hint">Start a conversation from someone's profile</span>
      </div>
    <% end %>
  </div>

  <!-- Requests Tab -->
  <div class="tab-content" data-tabs-target="content" style="display: none;">
    <% if @requests.any? %>
      <div class="requests-list" id="requests_list">
        <% @requests.each do |request| %>
          <%= render "conversations/request", conversation: request %>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <i class="fa-regular fa-envelope-open"></i>
        <p>No message requests</p>
        <span class="empty-hint">Message requests from people you don't follow will appear here</span>
      </div>
    <% end %>
  </div>
</div>

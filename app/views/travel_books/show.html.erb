<div class="travel-book-page" data-controller="travel-book-select">
  <!-- Header Section -->
  <section class="travel-book-header">
    <div class="header-content">
      <h1 class="header-title">My Travel Book</h1>
      <p class="header-subtitle">Your curated collection of destinations</p>
    </div>

    <!-- Header Actions (visible when items selected) -->
    <div class="tb-header-actions" data-travel-book-select-target="headerActions">
      <span class="tb-selected-count">
        <span data-travel-book-select-target="selectedCount">0</span> selected
      </span>
      <button class="tb-header-btn tb-pin-header-btn"
              data-travel-book-select-target="pinBtn"
              data-action="click->travel-book-select#pinSelected"
              title="Pin">
        <i class="fa-solid fa-thumbtack"></i>
      </button>
      <button class="tb-header-btn tb-delete-header-btn"
              data-travel-book-select-target="deleteBtn"
              data-action="click->travel-book-select#deleteSelected"
              title="Remove">
        <i class="fa-solid fa-trash"></i>
      </button>
    </div>
  </section>

  <% if @travel_book.places.any? %>
    <!-- Pinned Section -->
    <% pinned_tbps = @travel_book.travel_book_places.pinned.includes(place: [:city, :photo_attachments, comments: :photos_attachments]) %>
    <% if pinned_tbps.any? %>
      <section class="pinned-section">
        <div class="pinned-section-header">
          <h2 class="pinned-section-title">
            <i class="fa-solid fa-thumbtack"></i>
            Pinned
          </h2>
          <span class="pinned-count"><%= pinned_tbps.count %>/5</span>
        </div>

        <div class="places-grid">
          <% pinned_tbps.each do |tbp| %>
            <% place = tbp.place %>
            <% city = place.city %>
            <%= render "travel_books/place_card", place: place, city: city, tbp: tbp, pinned: true %>
          <% end %>
        </div>
      </section>
    <% end %>

    <!-- Regular Places by City -->
    <% unpinned_tbps = @travel_book.travel_book_places.unpinned.includes(place: [:city, :photo_attachments, comments: :photos_attachments]) %>
    <% unpinned_tbps.map { |tbp| [tbp, tbp.place] }.group_by { |tbp, place| place.city }.each do |city, tbp_place_pairs| %>
      <section class="city-section">
        <div class="city-section-header">
          <h2 class="city-section-title">
            <i class="fa-solid fa-location-dot"></i>
            <%= city.name %>
          </h2>
          <span class="places-count"><%= tbp_place_pairs.count %> <%= 'place'.pluralize(tbp_place_pairs.count) %></span>
        </div>

        <div class="places-grid">
          <% tbp_place_pairs.each do |tbp, place| %>
            <%= render "travel_books/place_card", place: place, city: city, tbp: tbp, pinned: false %>
          <% end %>
        </div>
      </section>
    <% end %>

  <% else %>
    <section class="empty-state">
      <div class="empty-state-content">
        <div class="empty-state-icon">
          <i class="fa-regular fa-bookmark"></i>
        </div>
        <h2 class="empty-state-title">Your Travel Book is empty</h2>
        <p class="empty-state-text">Start exploring cities and save places you'd like to visit</p>
        <%= link_to root_path, class: "empty-state-btn" do %>
          Discover destinations <i class="fa-solid fa-arrow-right"></i>
        <% end %>
      </div>
    </section>
  <% end %>
</div>

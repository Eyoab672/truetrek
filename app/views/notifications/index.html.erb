<%# Hide the navbar notification badges when on notifications page %>
<%= turbo_frame_tag "notif_badge_mobile" %>
<%= turbo_frame_tag "notif_badge_desktop" %>

<div class="notifications-page" data-controller="swipe-nav" data-swipe-nav-left-url-value="<%= conversations_path %>">
  <div class="notifications-header">
    <h1><i class="fa-regular fa-heart"></i> Activity</h1>
  </div>

  <% if @notifications.any? %>
    <div class="notifications-list">
      <% current_date = nil %>
      <% @notifications.each do |notification| %>
        <% notification_date = notification.created_at.to_date %>
        <% if notification_date != current_date %>
          <% current_date = notification_date %>
          <div class="notification-date-separator">
            <span class="notification-date">
              <% if notification_date == Date.today %>
                Today
              <% elsif notification_date == Date.yesterday %>
                Yesterday
              <% elsif notification_date > 1.week.ago.to_date %>
                <%= notification_date.strftime("%A") %>
              <% else %>
                <%= notification_date.strftime("%B %d, %Y") %>
              <% end %>
            </span>
          </div>
        <% end %>
        <div class="notification-card" id="notification_<%= notification.id %>">
          <div class="notification-avatar">
            <% if notification.actor.avatar.attached? %>
              <%= cl_image_tag notification.actor.avatar.key, width: 50, height: 50, crop: :fill, class: "avatar-img" %>
            <% else %>
              <div class="avatar-placeholder">
                <%= notification.actor.username&.first&.upcase %>
              </div>
            <% end %>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              <strong><%= link_to notification.actor.username, user_path(notification.actor) %></strong>
              <% case notification.action %>
              <% when "new_comment" %>
                posted a new review on
                <% if notification.notifiable.present? %>
                  <strong><%= link_to notification.notifiable.place.title, city_place_path(notification.notifiable.place.city, notification.notifiable.place) %></strong>
                <% else %>
                  a place
                <% end %>
              <% when "new_follow" %>
                started following you
              <% end %>
            </p>
            <span class="notification-time"><%= time_ago_in_words(notification.created_at) %> ago</span>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="empty-state">
      <i class="fa-regular fa-bell"></i>
      <p>No notifications yet</p>
      <span class="empty-hint">When someone follows you or people you follow post reviews, you'll see them here</span>
    </div>
  <% end %>
</div>
